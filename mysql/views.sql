DROP VIEW IF EXISTS `player_history`;
CREATE VIEW `player_history` AS select `p`.`idplayer` AS `idplayer`,`m`.`OpposingTeam` AS `OpposingTeam`,`m`.`MatchDate` AS `MatchDate`,`m`.`PlayOff` AS `Playoff`,`mu`.`MyPlayerRank` AS `MyPlayerRank`,`mu`.`MyPlayerScore` AS `MyPLayerScore`,`mu`.`OpponentName` AS `OpponentName`,`mu`.`OpponentRank` AS `OpponentRank`,`mu`.`OpponentScore` AS `OpponentScore`,`mu`.`WinLose` AS `WinLose` from ((`MatchUp` `mu` join `Match` `m` on((`m`.`idmatch` = `mu`.`Match_ID`))) join `Player` `p` on((`p`.`idplayer` = `mu`.`Player_ID`))) order by `m`.`MatchDate` desc;

DROP VIEW IF EXISTS `player_ranking`;
CREATE VIEW `player_ranking` AS select `mu`.`Player_ID` AS `Player_ID`,`p`.`FirstName` AS `FirstName`,`p`.`Surname` AS `Surname`,count(`mu`.`WinLose`) AS `MatchesPlayed`,sum(if((`mu`.`WinLose` = 'W'),1,0)) AS `Wins`,sum(`mu`.`MyPlayerActual`) AS `ActRacksWon`,sum(`mu`.`OpponentActual`) AS `ActRacksLost`,(sum(`mu`.`MyPlayerActual`) + sum(`mu`.`OpponentActual`)) AS `ActRacksPlayed`,sum(`mu`.`MyPlayerScore`) AS `RacksWon`,sum(`mu`.`OpponentScore`) AS `RacksLost`,(sum(`mu`.`MyPlayerScore`) + sum(`mu`.`OpponentScore`)) AS `RacksPlayed`,(sum(if((`mu`.`WinLose` = 'W'),1,0)) / count(`mu`.`WinLose`)) AS `MatchPct`,(sum(`mu`.`MyPlayerScore`) / (sum(`mu`.`MyPlayerScore`) + sum(`mu`.`OpponentScore`))) AS `RacksPct`,(sum(`mu`.`MyPlayerActual`) / (sum(`mu`.`MyPlayerActual`) + sum(`mu`.`OpponentActual`))) AS `ActPct`,`s`.`idseason` AS `idseason` from (((`Season` `s` join `Match` `m` on((`m`.`Season_ID` = `s`.`idseason`))) join `MatchUp` `mu` on((`m`.`idmatch` = `mu`.`Match_ID`))) join `Player` `p` on((`p`.`idplayer` = `mu`.`Player_ID`))) group by `s`.`idseason`,`mu`.`Player_ID` order by `MatchPct` desc;

DROP VIEW IF EXISTS `the_bog`;
CREATE VIEW `the_bog` AS select `m`.`Season_ID` AS `Season_ID`,`p`.`idplayer` AS `idplayer`,`p`.`Surname` AS `Surname`,max(if((`mu`.`WinLose` = 'L'),`m`.`MatchDate`,0)) AS `Lose`,max(if((`mu`.`WinLose` = 'W'),`m`.`MatchDate`,0)) AS `Win`,sum(if((`mu`.`WinLose` = 'L'),1,0)) AS `Losses`,count(0) AS `Played`,`p`.`Bogged` AS `Bogged`,`p`.`BoggedDate` AS `BoggedDate` from (((`MatchUp` `mu` join `Player` `p` on((`mu`.`Player_ID` = `p`.`idplayer`))) join `Match` `m` on((`mu`.`Match_ID` = `m`.`idmatch`))) join `Season` `s` on((`m`.`Season_ID` = `s`.`idseason`))) where ((`p`.`Active` = 'Y') and (`s`.`CurrentSeason` = 'Y')) group by `m`.`Season_ID`,`p`.`idplayer` order by `m`.`Season_ID` desc,`p`.`Bogged`,`p`.`BoggedDate`,`Lose`,`Losses`,`Played`;
